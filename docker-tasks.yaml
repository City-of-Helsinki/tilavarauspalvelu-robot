# Docker-specific Robot Framework tasks
# Process counts are synchronized via docker-config.sh

# To use with shared configuration:
# source ./docker-config.sh && rcc run -t "Task Name"

# Note: YAML anchors could be implemented in the future to reduce duplication
# For now, explicit commands provide better readability and maintainability

tasks:
  # Clean output directories
  Clean Output:
    shell: |
      [ -d output ] && rm -rf output/* || true
      [ -d pabot_results ] && rm -rf pabot_results/* || true
      [ -f log.html ] && rm -f log.html || true
      [ -f output.xml ] && rm -f output.xml || true
      [ -f report.html ] && rm -f report.html || true
      [ -f playwright-log.txt ] && rm -f playwright-log.txt || true

  # Build Docker image
  Build Docker:
    shell: |
      docker build -t robotframework-tests .

  # Parallel testing tasks for Docker
  Test Desktop Parallel Docker:
    shell: |
      source ./docker-config.sh
      docker run --rm \
        --env-file "$DOCKER_ENV_FILE" \
        -v "$TEST_DIR:/opt/robotframework/tests" \
        -v "$OUTPUT_DIR:/opt/robotframework/reports" \
        -v "$OUTPUT_DIR:/opt/robotframework/output" \
        robotframework-tests:latest pabot \
        --testlevelsplit \
        --processes ${DESKTOP_PROCESSES:-6} \
        --pabotlib \
        --exclude serialonly \
        --resourcefile /opt/robotframework/tests/Resources/test_value_sets.dat \
        --outputdir /opt/robotframework/reports \
        /opt/robotframework/tests/Tests_user_desktop_FI.robot

  Test Admin Parallel Docker:
    shell: |
      source ./docker-config.sh
      docker run --rm \
        --env-file "$DOCKER_ENV_FILE" \
        -v "$TEST_DIR:/opt/robotframework/tests" \
        -v "$OUTPUT_DIR:/opt/robotframework/reports" \
        -v "$OUTPUT_DIR:/opt/robotframework/output" \
        robotframework-tests:latest pabot \
        --testlevelsplit \
        --processes ${ADMIN_PROCESSES:-2} \
        --pabotlib \
        --exclude serialonly \
        --resourcefile /opt/robotframework/tests/Resources/test_value_sets.dat \
        --outputdir /opt/robotframework/reports \
        /opt/robotframework/tests/Tests_admin_desktop_FI.robot

  Test Mobile Android Parallel Docker:
    shell: |
      source ./docker-config.sh
      docker run --rm \
        --env-file "$DOCKER_ENV_FILE" \
        -v "$TEST_DIR:/opt/robotframework/tests" \
        -v "$OUTPUT_DIR:/opt/robotframework/reports" \
        -v "$OUTPUT_DIR:/opt/robotframework/output" \
        robotframework-tests:latest pabot \
        --testlevelsplit \
        --processes ${MOBILE_PROCESSES:-3} \
        --pabotlib \
        --exclude serialonly \
        --resourcefile /opt/robotframework/tests/Resources/test_value_sets.dat \
        --outputdir /opt/robotframework/reports \
        /opt/robotframework/tests/Tests_user_mobile_android_FI.robot

  Test Mobile iPhone Parallel Docker:
    shell: |
      source ./docker-config.sh
      docker run --rm \
        --env-file "$DOCKER_ENV_FILE" \
        -v "$TEST_DIR:/opt/robotframework/tests" \
        -v "$OUTPUT_DIR:/opt/robotframework/reports" \
        -v "$OUTPUT_DIR:/opt/robotframework/output" \
        robotframework-tests:latest pabot \
        --testlevelsplit \
        --processes ${MOBILE_PROCESSES:-3} \
        --pabotlib \
        --exclude serialonly \
        --resourcefile /opt/robotframework/tests/Resources/test_value_sets.dat \
        --outputdir /opt/robotframework/reports \
        /opt/robotframework/tests/Tests_user_mobile_iphone_FI.robot

  Test All Suites Parallel Docker:
    shell: |
      source ./docker-config.sh
      docker run --rm \
        --env-file "$DOCKER_ENV_FILE" \
        -v "$TEST_DIR:/opt/robotframework/tests" \
        -v "$OUTPUT_DIR:/opt/robotframework/reports" \
        -v "$OUTPUT_DIR:/opt/robotframework/output" \
        robotframework-tests:latest pabot \
        --processes ${ALL_SUITES_PROCESSES:-3} \
        --pabotlib \
        --exclude serialonly \
        --resourcefile /opt/robotframework/tests/Resources/test_value_sets.dat \
        --outputdir /opt/robotframework/reports \
        /opt/robotframework/tests/Tests_user_desktop_FI.robot \
        /opt/robotframework/tests/Tests_admin_desktop_FI.robot \
        /opt/robotframework/tests/Tests_admin_notifications_serial.robot \
        /opt/robotframework/tests/Tests_users_with_admin_desktop.robot \
        /opt/robotframework/tests/Tests_user_mobile_android_FI.robot \
        /opt/robotframework/tests/Tests_user_mobile_iphone_FI.robot

  # Sequential testing tasks for Docker
  Test Desktop Single Docker:
    shell: |
      source ./docker-config.sh
      docker run --rm \
        --env-file "$DOCKER_ENV_FILE" \
        -v "$TEST_DIR:/opt/robotframework/tests" \
        -v "$OUTPUT_DIR:/opt/robotframework/reports" \
        -v "$OUTPUT_DIR:/opt/robotframework/output" \
        robotframework-tests:latest robot \
        --variable FORCE_SINGLE_USER:True \
        --outputdir /opt/robotframework/reports \
        /opt/robotframework/tests/Tests_user_desktop_FI.robot

  Test Admin Single Docker:
    shell: |
      source ./docker-config.sh
      docker run --rm \
        --env-file "$DOCKER_ENV_FILE" \
        -v "$TEST_DIR:/opt/robotframework/tests" \
        -v "$OUTPUT_DIR:/opt/robotframework/reports" \
        -v "$OUTPUT_DIR:/opt/robotframework/output" \
        robotframework-tests:latest robot \
        --variable FORCE_SINGLE_USER:True \
        --outputdir /opt/robotframework/reports \
        /opt/robotframework/tests/Tests_admin_desktop_FI.robot

  Test Admin Notifications Serial Docker:
    shell: |
      source ./docker-config.sh
      docker run --rm \
        --env-file "$DOCKER_ENV_FILE" \
        -v "$TEST_DIR:/opt/robotframework/tests" \
        -v "$OUTPUT_DIR:/opt/robotframework/reports" \
        -v "$OUTPUT_DIR:/opt/robotframework/output" \
        robotframework-tests:latest robot \
        --variable FORCE_SINGLE_USER:True \
        --outputdir /opt/robotframework/reports \
        /opt/robotframework/tests/Tests_admin_notifications_serial.robot

  Test Users With Admin Single Docker:
    shell: |
      source ./docker-config.sh
      docker run --rm \
        --env-file "$DOCKER_ENV_FILE" \
        -v "$TEST_DIR:/opt/robotframework/tests" \
        -v "$OUTPUT_DIR:/opt/robotframework/reports" \
        -v "$OUTPUT_DIR:/opt/robotframework/output" \
        robotframework-tests:latest robot \
        --variable FORCE_SINGLE_USER:True \
        --outputdir /opt/robotframework/reports \
        /opt/robotframework/tests/Tests_users_with_admin_desktop.robot

  # Quick test with minimal processes
  Test Desktop Quick Docker:
    shell: |
      source ./docker-config.sh
      docker run --rm \
        --env-file "$DOCKER_ENV_FILE" \
        -v "$TEST_DIR:/opt/robotframework/tests" \
        -v "$OUTPUT_DIR:/opt/robotframework/reports" \
        -v "$OUTPUT_DIR:/opt/robotframework/output" \
        robotframework-tests:latest pabot \
        --processes 2 \
        --pabotlib \
        --exclude serialonly \
        --resourcefile /opt/robotframework/tests/Resources/test_value_sets.dat \
        --outputdir /opt/robotframework/reports \
        /opt/robotframework/tests/Tests_user_desktop_FI.robot
